{
    "collab_server" : "",
    "contents" : "f.sel_cai_var <- function(var_n, ind_int) {\n  cai_df %>%\n    filter(internacao == ind_int) %>% \n    arrange(amq) %>% \n    select(var_n) %>% \n    as.tibble()  \n}\n\nf.sel_cai_var(c('taxa', 'consulta'), 'n')\n\ncai_ECn_PTs.corP <- cbind(f.sel_cai_var(c('emergencia', 'consulta'), 'n'),\n                          f.sel_cai_var(c('taxa', 'pacote'), 's')) %>% \n  .[1:77,] %>% \n  cor(., method = 'pearson')\n\n\ntopcorS_W <- topcorS %>% \n  add_column(Var1_prct = resumo_valor_S[match(topcorS$Var1, resumo_valor_S$componente),4]) %>% \n  add_column(Var2_prct = resumo_valor_S[match(topcorS$Var2, resumo_valor_S$componente),4]) %>% \n  select(\"Var1\",\"Var1_prct\",\"Var2\",\"Var2_prct\",Corr = \"value\")\n\ntopcorN_W <- topcorN %>% \n  add_column(Var1_prct = resumo_valor_N[match(topcorN$Var1, resumo_valor_N$componente),4]) %>% \n  add_column(Var2_prct = resumo_valor_N[match(topcorN$Var2, resumo_valor_N$componente),4]) %>% \n  select(\"Var1\",\"Var1_prct\",\"Var2\",\"Var2_prct\",Corr = \"value\")\n\nf.cor_plot <- function(ds, plt, dirc, lab_leg, dig) {\n  GGcor <- ggplot(data = melt(ds, na.rm = TRUE), aes(Var2, Var1, fill = value)) +\n    geom_tile(color = \"white\") +\n    scale_fill_distiller(palette = plt, \n                        direction = dirc,\n                        name=lab_leg) +  \n    theme_minimal()+ \n    theme(axis.text.x = element_text(angle = 45, \n                                    vjust = 1, \n                                    size = 12, \n                                    hjust = 1),\n          axis.title.x = element_blank(),\n          axis.title.y = element_blank())+\n    guides(fill = guide_colorbar(barwidth = 1, \n                                barheight = 7,\n                                title.position = \"bottom\")) +\n    coord_fixed()\n  GGcor + \n    geom_text(aes(Var2, Var1, label = format(value, digits = dig, nsmall= 3)), \n              color = \"black\", \n              size = 3)\n}\n\nf.cor_plot(caiN.corP,\"RdYlGn\", 1,\"Correlação de\\nPearson\\n|Ambulatório|\",1)\n\nf.cor_plot(caiS.corP,\"Set2\", -1,\"Correlação de\\nPearson\\n|Internação|\",2)\n\nf.sel_cai_var(c('taxa', 'consulta'), 'n')\n\ncai_SCs <- cbind(f.sel_cai_var('sadt','s'), f.sel_cai_var('consulta','n'))\n\ncai_SCn <- cbind(f.sel_cai_var('sadt','n'), f.sel_cai_var('consulta','n'))\n\n#### Preparação: Consulta sobre exames sem Internação -------\n\n\n#### Preparação: Consulta sobre exames totais ---------------\n\n#rm(cai_SCc)\n\ncai_SCc <- cai_df %>% \n  select(amq,sadt) %>% \n  group_by(amq) %>% \n  summarise(sadt=sum(sadt)) %>% \n  as.data.frame() %>% \n  select(sadt) %>% \n  as.tibble() %>% \n  add_column(consulta = f.sel_cai_var('consulta','n'))\n\n## Inclusão de coluna \"z\", análise de variação por desvios padrão, outliers acima de 3 \nzSc <- scale(cai_SCc$sadt, center = TRUE, scale = TRUE) \ncai_SCc <- cai_SCc %>% add_column(z = zSc[1:dim(cai_SCc)[1]])\n\nsmr <- summary(lm.cai_SCc)\n\nsmr$r.squared\nsmr$terms\nsmr$terms[[2]]\nsmr$terms[[3]]\n\nSCc.CI <- as.tibble(predict.lm(lm.cai_SCc, level=0.95, interval = 'confidence')) %>% \n  add_column(., rn = as.numeric(row.names(SCc.CI)))\ncai_SCc <- add_column(cai_SCc, rn = as.numeric(row.names(SCc.CI)))\n\n#----------------------------------------------------------------------------------\nrm(vn,x,y)\nvn <- f.cor_smst(smst.corP, 'consulta', 'honorario')\nvn\n\n\n\n\nggplot(SCc.CI[25:65,], aes(x = rn, y = fit, col = fit)) +\n  geom_point(size = 2) +\n  geom_errorbar(aes(ymax = upr, ymin = lwr)) +\n  #geom_line(color = \"light blue\", size = 0.4, alpha = 0.5) +\n  geom_point(data = cai_SCc[25:65,], aes(y = sadt),col = \"red\" , size = 1.5) +\n  theme_dark() +\n  geom_smooth(col = 'white', method = \"loess\", alpha = 0.2, linetype = 3, size = 0.5) +\n  scale_colour_gradient2(name=\"Variação em\\ntorno da média\", \n                         low = \"white\", \n                         mid = \"orange\",\n                         midpoint = 591713,\n                         high = \"white\") +\n  labs(title = 'Amostra de assertividade nas previsões', \n       x = 'Observações', y = 'Valor Previsto')\n\nclass(sum)\nattributes(\"mutate\")\nclass(print)\n.Primitive(\"mutate\")\n\nclass(mutate)\n??srcref\n\nattr(f.cor_plot, \"srcref\")\nbody(mutate)\nbody(UseMethod)\n\n.Primitive(\"UseMethod\")\n\nsum\nmget\n\nobjs <- mget(ls(\"package:base\"), inherits = TRUE)\nfuns <- Filter(is.function, objs)\n\nstr(funs)\n\nstr(funs$abbreviate)\n\nlen(formals(funs$abbreviate))\n\nlength(formals(funs$abbreviate))\n\nsiz <- lapply(lapply(funs, formals), length)\nlenV <- vector()\nfor (i in seq_along(siz)) {\n  lenV[i] <- siz[[i]]\n}\n\n\n\nlenV\nmax(lenV)\n\nseq_along(siz)\n\nmap(siz, '[[', 1)\n\nfuns['[[']\n",
    "created" : 1501159633604.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1233398538",
    "id" : "49F1051E",
    "lastKnownWriteTime" : 1502379404,
    "last_content_update" : 1502379405109,
    "path" : "~/R/Estudo_Componente_Geral/functionals.R",
    "project_path" : "functionals.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}