x_1 <- as.tibble() %>%
map_df(character, names(mn.ano[[1]])[-2])
View(x_1)
as.tibble(1:17)
x_1 <- as.tibble(1:17) %>%
map_df(colnames, names(mn.ano[[1]])[-2])
x_1 <- as.tibble(1:17) %>%
map_chr(colnames, names(mn.ano[[1]])[-2])
setNames(tibble(matrix(ncol = 17, nrow = 0)), names(mn.ano[[1]])[-2])
setNames(data.frame(matrix(ncol = 17, nrow = 0)), names(mn.ano[[1]])[-2])
t <- setNames(data.frame(matrix(ncol = 17, nrow = 0)), names(mn.ano[[1]])[-2])
View(t)
t <- setNames(data.frame(matrix(ncol = 17, nrow = 0)), names(mn.ano[[1]])[-2]) %>%
as.tibble()
mn.ano[[1]][3:17]
mn.ano[[1]]
mn.ano[1]
names(mn.ano[1])
c(names(mn.ano[1]),mn.ano[[1]][3:17])
vv_ano[1] <- c(names(mn.ano[1]),mn.ano[[1]][3:17])
vv_ano <- setNames(data.frame(matrix(ncol = 16, nrow = 0)), names(mn.ano[[1]])[-2]) %>%
as.tibble()
x_vv_main <- read_excel('BV_extract_sqlbi.xls') %>%
mutate(ANOMES = factor(.$ANOMES, .$ANOMES), ANO = factor(.$ANO)) %>%
as.tibble()
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 16, nrow = 0)), names(mn.ano[[1]])[-2]) %>%
as.tibble()
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)), names(mn.ano[[1]])[-2]) %>%
as.tibble()
View(vv_ano)
vv_ano[1] <- c(1,names(mn.ano[1]),mn.ano[[1]][3:17])
length(mn.ano)
x_vv_main <- read_excel('BV_extract_sqlbi.xls') %>%
mutate(ANOMES = factor(.$ANOMES, .$ANOMES), ANO = factor(.$ANO)) %>%
as.tibble()
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = length(mn.ano))),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
vv_ano[1] <- c(names(mn.ano[1]),mn.ano[[1]][3:17])
mn.ano[[1]][3:17]
str(mn.ano[[1]][3:17])
str(mn.ano[[1]][3:17][1])
str(mn.ano[[1]][3:17][2])
str(mn.ano[[1]][3:17][1,1])
str(mn.ano[[1]][3:17])
str(names(mn.ano[[1]])[-2])
mn.ano[[1]][3:17]
mn.ano[[1]][3:18]
vv_ano[1] <- c(names(mn.ano[1]),mn.ano[[1]][3:18])
vv_ano[1] <- t(names(mn.ano[1]),mn.ano[[1]][3:18])
vv_ano[1] <- t(c(names(mn.ano[1]),mn.ano[[1]][3:18]))
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
vv_ano[1] <- t(c(names(mn.ano[1]),mn.ano[[1]][3:18]))
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 1)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
vv_ano[1] <- t(c(names(mn.ano[1]),mn.ano[[1]][3:18]))
View(vv_ano)
c(names(mn.ano[1]),mn.ano[[1]][3:18])
c(ANO = names(mn.ano[1]),mn.ano[[1]][3:18])
vv_ano[1, 1:17] <- c(ANO = names(mn.ano[1]),mn.ano[[1]][3:18])
View(vv_ano)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
vv_ano[1, 1:17] <- c(ANO = names(mn.ano[1]),mn.ano[[1]][3:18])
View(vv_ano)
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) {
vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
}
View(vv_ano)
str(vv_ano)
map_chr(vv_ano[, 2:17], print)
map_df(vv_ano[, 2:17], print)
map_df(vv_ano[1, 2:17], print)
map_df(vv_ano[, 2:17], ~mutate(.=as.double(.)))
for (i in 2:17) {
vv_ano[,i] <- mutate(vv_ano[,i] = as.double(vv_ano[,i]))
vv_ano[,2] <- mutate(vv_ano[,2] = as.double(vv_ano[,2]))
vv_ano[,2] <- as.double(vv_ano[,2])
View(vv_ano)
vv_ano[,2] <- as.numeric(vv_ano[,2])
str(vv_ano)
vv_ano$QP <- as.numeric(vv_ano$QP)
str(vv_ano)
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) {
vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
}
vv_ano$QP <- as.double(vv_ano$QP)
str(vv_ano)
View(vv_ano)
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) {
vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
}
vv_ano$QP <- double(vv_ano$QP)
vv_ano$QP <- double(vv_ano$QP,2)
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) {
vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
}
vv_ano$QP <- double(vv_ano$QP,2)
vv_ano$QP <- as.double(vv_ano$QP,2)
View(vv_ano)
map_df(vv_ano, as.double)
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) {
vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
}
map_df %<>% (as.double)
map_df[,2:17] %<>% (as.double)
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) {
vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
}
map_df[,2:17] %<>% (as.double)
vv_ano[,2:17] %<>% map_df(as.double)
View(vv_ano)
str(vv_ano)
vv_ano$ano <- factor(vv_ano$ano, levels = vv_ano$ano)
vv_ano$ANO <- factor(vv_ano$ANO, levels = vv_ano$ANO)
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
x_vv_main <- read_excel('BV_extract_sqlbi.xls') %>%
mutate(ANOMES = factor(.$ANOMES, .$ANOMES), ANO = factor(.$ANO)) %>%
as.tibble()
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) {
vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
}
vv_ano[,2:17] %<>% map_df(as.double)
vv_ano[,1] <- factor(vv_ano[,1], levels = vv_ano[,1])
str(vv_ano)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) {
vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
}
vv_ano[,2:17] %<>% map_df(as.double)
vv_ano$ANO <- factor(vv_ano$ANO)
str(vv_ano)
View(vv_ano)
View(x_vv_main)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
vv_ano[,2:17] %<>% map_df(as.double)
vv_ano$ANO %<>% factor(.)
str(vv_ano)
c(vv_ano$ANO,lag(vv_ano$ANO))
c(vv_ano$QT,lag(vv_ano$QT))
c(vv_ano$QA,lag(vv_ano$QA))
t <- as.tibble(c(vv_ano$QA,lag(vv_ano$QA)))
View(t)
t <- as.tibble(cbind(vv_ano$QA,lag(vv_ano$QA)))
View(t)
lag(vv_ano$QA)
(vv_ano$QA-lag(vv_ano$QA))/lag(vv_ano$QA)
f.lag_perc <- function(clmn){
(clmn-lag(clmn))/lag(clmn)
}
f.lag_perc <- function(clmn) (clmn-lag(clmn))/lag(clmn)
f.lag_perc(vv_ano$QP)
f.lag_perc(vv_ano$QA)
t <- vv_ano[,2:17] %>% map_df(mutate, f.lag_perc(.))
t <- vv_ano[,2:17] %>% map_df(f.lag_perc)
t <- vv_ano[,2:17] %>% map_df(function(.) (.-lag(.))/lag(.))
f.lag_perc <- function(col) (col-lag(col))/lag(col)
vv_var_perc_ano <- vv_ano[,2:17] %>% map_df(function(.) (.-lag(.))/lag(.))
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) (.-lag(.))/lag(.)) %>%
'['(,2:4)
View(t)
View(vv_var_perc_ano)
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
vv_ano[,2:17] %<>% map_df(as.double)
vv_ano$ANO %<>% factor(.)
f.lag_perc <- function(col) (col-lag(col))/lag(col)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) (.-lag(.))/lag(.)) %>%
'['(2:4,)
View(vv_var_perc_ano)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) (.-lag(.))/lag(.)) %>%
'['(2:4,) %>%
cbind(vv_ano[2:4,1],.)
View(vv_var_perc_ano)
dim(vv_ano)[1]
x_vv_main <- read_excel('BV_extract_sqlbi.xls') %>%
mutate(ANOMES = factor(.$ANOMES, .$ANOMES), ANO = factor(.$ANO)) %>%
as.tibble()
## Opções iniciais de configuração do ambiente --------------
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
#### --------------------------------------------------------
library("stringr", lib.loc="~/R/win-library/3.4")
library("dplyr", lib.loc="~/R/win-library/3.4")
library("ggplot2", lib.loc="~/R/win-library/3.4")
library("readr", lib.loc="~/R/win-library/3.4")
library("tibble", lib.loc="~/R/win-library/3.4")
library("tidyr", lib.loc="~/R/win-library/3.4")
library("magrittr", lib.loc="~/R/win-library/3.4")
library("readxl", lib.loc="~/R/win-library/3.4")
library("purrr", lib.loc="~/R/win-library/3.4")
#### --------------------------------------------------------
x_vv_main <- read_excel('BV_extract_sqlbi.xls') %>%
mutate(ANOMES = factor(.$ANOMES, .$ANOMES), ANO = factor(.$ANO)) %>%
as.tibble()
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
vv_ano[,2:17] %<>% map_df(as.double)
vv_ano$ANO %<>% factor(.)
f.lag_perc <- function(col) (col-lag(col))/lag(col)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) (.-lag(.))/lag(.)) %>%
'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[2:dim(vv_ano)[1],1],.)
View(vv_var_perc_ano)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[2:dim(vv_ano)[1],1],.)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
#'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[,1],.)#2:dim(vv_ano)[1]
View(vv_var_perc_ano)
## Opções iniciais de configuração do ambiente --------------
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
#### --------------------------------------------------------
library("stringr", lib.loc="~/R/win-library/3.4")
library("dplyr", lib.loc="~/R/win-library/3.4")
library("ggplot2", lib.loc="~/R/win-library/3.4")
library("readr", lib.loc="~/R/win-library/3.4")
library("tibble", lib.loc="~/R/win-library/3.4")
library("tidyr", lib.loc="~/R/win-library/3.4")
library("magrittr", lib.loc="~/R/win-library/3.4")
library("readxl", lib.loc="~/R/win-library/3.4")
library("purrr", lib.loc="~/R/win-library/3.4")
#### --------------------------------------------------------
x_vv_main <- read_excel('BV_extract_sqlbi.xls') %>%
mutate(ANOMES = factor(.$ANOMES, .$ANOMES), ANO = factor(.$ANO)) %>%
as.tibble()
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
vv_ano[,2:17] %<>% map_df(as.double)
vv_ano$ANO %<>% factor(.)
#f.lag_perc <- function(col) (col-lag(col))/lag(col)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
#'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[,1],.)#2:dim(vv_ano)[1]
colnames(vv_var_perc_ano)
colnames(vv_var_perc_ano) <- paste0(colnames(vv_var_perc_ano),'.vp')
colnames(vv_var_perc_ano)
vv_ano_n <- merge(vv_ano_n, vv_var_perc_ano, by.x = ANO, by.y = ANO.vp)
vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by.x = ANO, by.y = ANO.vp)
vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by.x = vv_ano$ANO, by.y = vv_var_perc_ano$ANO.vp)
cbind(vv_ano[,1],.)#2:dim(vv_ano)[1]
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
#'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[,1],.)#2:dim(vv_ano)[1]
##
# Renomeia nomes de colunas, para junção de planilhas
##
colnames(vv_var_perc_ano[,2:17]) <- paste0(colnames(vv_var_perc_ano[,2:17]),'.vp')
vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by.x = vv_ano$ANO, by.y = vv_var_perc_ano$ANO.vp)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
#'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[,1],.)#2:dim(vv_ano)[1]
##
# Renomeia nomes de colunas, para junção de planilhas
##
colnames(vv_var_perc_ano[,2:17]) <- paste0(colnames(vv_var_perc_ano[,2:17]),'.vp')
#vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by.x = vv_ano$ANO, by.y = vv_var_perc_ano$ANO.vp)
View(vv_var_perc_ano)
colnames(vv_var_perc_ano[,2:17])
colnames(vv_var_perc_ano[,2:17]) <- paste0(colnames(vv_var_perc_ano[,2:17]),'.vp')
View(vv_var_perc_ano)
View(vv_var_perc_ano)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
#'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[,1],.)#2:dim(vv_ano)[1]
##
# Renomeia nomes de colunas, para junção de planilhas
##
colnames(vv_var_perc_ano[,2:17]) <- paste0(colnames(vv_var_perc_ano[,2:17]),'.vp')
#vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by.x = vv_ano$ANO, by.y = vv_var_perc_ano$ANO.vp)
x_vv_main <- read_excel('BV_extract_sqlbi.xls') %>%
mutate(ANOMES = factor(.$ANOMES, .$ANOMES), ANO = factor(.$ANO)) %>%
as.tibble()
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
vv_ano[,2:17] %<>% map_df(as.double)
vv_ano$ANO %<>% factor(.)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
#'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[,1],.)#2:dim(vv_ano)[1]
##
# Renomeia nomes de colunas, para junção de planilhas
##
colnames(vv_var_perc_ano[,2:17]) <- paste0(colnames(vv_var_perc_ano[,2:17]),'.vp')
#vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by.x = vv_ano$ANO, by.y = vv_var_perc_ano$ANO.vp)
View(vv_var_perc_ano)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
#'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[,1],.)#2:dim(vv_ano)[1]
##
# Renomeia nomes de colunas, para junção de planilhas
##
colnames(vv_var_perc_ano) <- paste0(colnames(vv_var_perc_ano),'.vp')
#vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by.x = vv_ano$ANO, by.y = vv_var_perc_ano$ANO.vp)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
#'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[,1],.)#2:dim(vv_ano)[1]
##
# Renomeia nomes de colunas, para junção de planilhas
##
colnames(vv_var_perc_ano) <- paste0(colnames(vv_var_perc_ano),'.vp')
#vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by.x = vv_ano$ANO, by.y = vv_var_perc_ano$ANO.vp)
x_vv_main <- read_excel('BV_extract_sqlbi.xls') %>%
mutate(ANOMES = factor(.$ANOMES, .$ANOMES), ANO = factor(.$ANO)) %>%
as.tibble()
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
for (i in seq_along(mn.ano)) vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
vv_ano[,2:17] %<>% map_df(as.double)
vv_ano$ANO %<>% factor(.)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
#'['(2:dim(vv_ano)[1],) %>%
cbind(vv_ano[,1],.)#2:dim(vv_ano)[1]
##
# Renomeia nomes de colunas, para junção de planilhas
##
colnames(vv_var_perc_ano) <- paste0(colnames(vv_var_perc_ano),'.vp')
#vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by.x = vv_ano$ANO, by.y = vv_var_perc_ano$ANO.vp)
View(vv_var_perc_ano)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
cbind(vv_ano[,1],.)
colnames(vv_var_perc_ano) <- paste0(colnames(vv_var_perc_ano),'.vp')
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
cbind(vv_ano[,1],.)
colnames(vv_var_perc_ano[,2:17]) <- paste0(colnames(vv_var_perc_ano[,2:17]),'.vp')
View(vv_var_perc_ano)
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
cbind(vv_ano[,1],.)
colnames(vv_var_perc_ano) <- paste0(colnames(vv_var_perc_ano),'.vp')
colnames(vv_var_perc_ano$ANO.vp) <- 'ANO'
names(vv_var_perc_ano$ANO.vp) <- 'ANO'
View(vv_var_perc_ano)
View(vv_var_perc_ano)
names(vv_var_perc_ano$ANO.vp)
names(vv_var_perc_ano[,1])
colnames(vv_var_perc_ano[,1])
names(vv_var_perc_ano)
names(vv_var_perc_ano)[1]
names(vv_var_perc_ano)[1] <- 'ANO'
names(vv_var_perc_ano)[1] <- 'ANO'
View(vv_var_perc_ano)
vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by = ANO)
vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by = 'ANO')
View(vv_ano_n)
vv_ano_n <- vv_ano_n[,c(1,2,18,3,19,4,20,5,21,6,22,7,23,8,24,9,25,10,26,
11,27,12,28,13,29,14,30,15,31,16,32,17,33)]
View(vv_ano_n)
## Opções iniciais de configuração do ambiente --------------
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
#### --------------------------------------------------------
library("stringr", lib.loc="~/R/win-library/3.4")
library("dplyr", lib.loc="~/R/win-library/3.4")
library("ggplot2", lib.loc="~/R/win-library/3.4")
library("readr", lib.loc="~/R/win-library/3.4")
library("tibble", lib.loc="~/R/win-library/3.4")
library("tidyr", lib.loc="~/R/win-library/3.4")
library("magrittr", lib.loc="~/R/win-library/3.4")
library("readxl", lib.loc="~/R/win-library/3.4")
library("purrr", lib.loc="~/R/win-library/3.4")
#### --------------------------------------------------------
x_vv_main <- read_excel('BV_extract_sqlbi.xls') %>%
mutate(ANOMES = factor(.$ANOMES, .$ANOMES), ANO = factor(.$ANO)) %>%
as.tibble()
##
# Quebra em blocos por ano, calcula a média de cada variável, armazena em lista de planilhas
##
mn.ano <- x_vv_main %>%
split(.$ANO) %>%
map(map_dbl, mean)
##
# Cria planilha vazia com nomes de colunas a partir de um bloco da lista acima
##
vv_ano <- setNames(data.frame(matrix(ncol = 17, nrow = 0)),
names(mn.ano[[1]])[-2]) %>%
as.tibble()
##
# Extrai variáveis dos blocos na lista para a planilha vazia
##
for (i in seq_along(mn.ano)) vv_ano[i, 1:17] <- c(ANO = names(mn.ano[i]),mn.ano[[i]][3:18])
##
# Converte variáveis para número de dupla precisão e ano para fator
##
vv_ano[,2:17] %<>% map_df(as.double)
vv_ano$ANO %<>% factor(.)
# Função para calculo de variação percentual em relação ao ano anterior
# f.lag_perc <- function(col) (col-lag(col))/lag(col)
##
# Calcula a variação percentual ano a ano de cada variável
##
vv_var_perc_ano <- vv_ano[,2:17] %>%
map_df(function(.) ((.-lag(.))/lag(.)*100)) %>%
cbind(vv_ano[,1],.)
## 2 #'['(2:dim(vv_ano)[1],) %>%
## 3 #2:dim(vv_ano)[1]
##
# Renomeia colunas, para junção de planilhas
##
colnames(vv_var_perc_ano) <- paste0(colnames(vv_var_perc_ano),'.vp')
names(vv_var_perc_ano)[1] <- 'ANO'
##
# Junção de planilhas e reordenação de campos
##
vv_ano_n <- merge(vv_ano, vv_var_perc_ano, by = 'ANO')
vv_ano_n <- vv_ano_n[,c(1,2,18,3,19,4,20,5,21,6,22,7,23,8,24,9,25,
10,26,11,27,12,28,13,29,14,30,15,31,16,32,17,33)]
View(vv_ano_n)
